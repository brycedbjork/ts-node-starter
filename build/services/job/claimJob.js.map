{"version":3,"sources":["../../../src/services/job/claimJob.ts"],"names":["claimJob","uid","jobId","jobData","hirer","id","chat","type","displayLocation","chatData","chatId","req","res","body","status","json","send","console","log","Sentry","captureException"],"mappings":";;;;;;;AAIA;;AACA;;AAEA;;AACA;;AACA;;;;;;;;;;;;AAEO,IAAMA,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA,0BAAG,iBAAOC,GAAP,EAAoBC,KAApB;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAEA,2BAAUA,KAAV,uEACHD,GADG,GACK,IADL,yCAEZ,SAFY,eAFA;;AAAA;AAEhBE,YAAAA,OAFgB;AAAA;AAAA,mBAQK,4BAAWF,GAAX,EAAgBE,OAAO,CAACC,KAAR,CAAcC,EAA9B,EAAkCH,KAAlC,CARL;;AAAA;AAAA;AAQdG,YAAAA,EARc,SAQdA,EARc;AAQVC,YAAAA,IARU,SAQVA,IARU;AAUtB;AACA,2DAAuBH,OAAO,CAACI,IAA/B,iBAA0CJ,OAAO,CAACK,eAAlD;AAXsB,6CAaf;AACLL,cAAAA,OAAO,EAAPA,OADK;AAELM,cAAAA,QAAQ,EAAEH,IAFL;AAGLI,cAAAA,MAAM,EAAEL;AAHH,aAbe;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAARL,QAAQ;AAAA;AAAA;AAAA,GAAd;;;;;;;;;0BAoBQ,kBAAOW,GAAP,EAAiBC,GAAjB;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBAE4CD,GAAG,CAACE,IAFhD,EAEHZ,GAFG,aAEHA,GAFG,EAEEC,KAFF,aAEEA,KAFF;AAAA;AAAA,mBAIiCF,QAAQ,CAACC,GAAD,EAAMC,KAAN,CAJzC;;AAAA;AAAA;AAIHC,YAAAA,OAJG,SAIHA,OAJG;AAIMO,YAAAA,MAJN,SAIMA,MAJN;AAIcD,YAAAA,QAJd,SAIcA,QAJd;AAMXG,YAAAA,GAAG,CAACE,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACnBb,cAAAA,KAAK,EAALA,KADmB;AAEnBQ,cAAAA,MAAM,EAANA,MAFmB;AAGnBP,cAAAA,OAAO,EAAPA,OAHmB;AAInBM,cAAAA,QAAQ,EAARA;AAJmB,aAArB;AANW;AAAA,mBAaL,mCAAkBR,GAAlB,EAAuBC,KAAvB,EAA8BQ,MAA9B,EAAsCP,OAAtC,EAA+CM,QAA/C,CAbK;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAeXG,YAAAA,GAAG,CAACE,MAAJ,CAAW,GAAX,EAAgBE,IAAhB;AACAC,YAAAA,OAAO,CAACC,GAAR,CAAY,wBAAZ;AACAC,YAAAA,MAAM,CAACC,gBAAP;;AAjBW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G","sourcesContent":["import { firestore, messaging } from \"../../firebase\";\nimport admin from \"firebase-admin\";\nimport moment from \"moment\";\nimport { JobPost, Job } from \"../../schemas/Job\";\nimport * as Sentry from \"@sentry/node\";\nimport slack from \"../../utils/slack\";\nimport { Student } from \"../../schemas/User\";\nimport claimNotification from \"../notification/claimNotification\";\nimport { createChat } from \"../chat/createChat\";\nimport { updateJob } from \"../job/updateJob\";\n\nexport const claimJob = async (uid: string, jobId: string) => {\n  // update job with claim\n  const jobData = await updateJob(jobId, {\n    [`matchedUsers.${uid}`]: true,\n    status: \"claimed\"\n  });\n\n  // create chat\n  const { id, chat } = await createChat(uid, jobData.hirer.id, jobId);\n\n  // log\n  slack(`*Job Claimed* ${jobData.type} in ${jobData.displayLocation}`);\n\n  return {\n    jobData,\n    chatData: chat,\n    chatId: id\n  };\n};\n\nexport default async (req: any, res: any) => {\n  try {\n    const { uid, jobId }: { uid: string; jobId: string } = req.body;\n\n    const { jobData, chatId, chatData } = await claimJob(uid, jobId);\n\n    res.status(200).json({\n      jobId,\n      chatId,\n      jobData,\n      chatData\n    });\n\n    await claimNotification(uid, jobId, chatId, jobData, chatData);\n  } catch (error) {\n    res.status(500).send(error);\n    console.log(\"Error: \" + error);\n    Sentry.captureException(error);\n  }\n};\n"],"file":"claimJob.js"}